\include{settings}

\begin{document}

\include{titlepage}

\tableofcontents
\newpage

\section{Техническое задание}

% Раздел «Техническое задание» должен содержать подробное описание задания на разработку. Здесь следует указать все требования, предъявляемые к разрабатываемым приложениям, описать накладываемые ограничения.

\textbf{Система передачи файлов}.

\begin{itemize}
	\item \textbf{Задание:} разработать приложение-клиент и приложение сервер, обеспечивающие функции обмена файлами.

	\item \textbf{Серверное} приложение должно реализовывать следующие функции:
	\begin{enumerate}
		\item Прослушивание определенного порта
		\item Обработка запросов на подключение по этому порту от клиентов
		\item Поддержка одновременной работы нескольких клиентов через механизм нитей
		\item Приём файла от клиента
		\item Передача по запросу клиента списка файлов текущего каталога
		\item Приём запросов на передачу файла и передача файла клиенту
		\item Навигация по системе каталогов
		\item Обработка запроса на отключение клиента
		\item Принудительное отключение клиента
	\end{enumerate}

	\item \textbf{Клиентское} приложение должно реализовывать следующие функции:
	\begin{enumerate}
		\item Установление соединения с сервером
		\item Получение от сервера списка файлов каталога
		\item Операции навигации по системе каталогов
		\item Передача файла серверу
		\item Приём файла от сервера
		\item Разрыв соединения
		\item Обработка ситуации отключения клиента сервером
	\end{enumerate}

	\item \textbf{Настройки приложений.} Разработанное клиентское приложение должно предоставлять пользователю настройку IP-адреса или доменного имени файл-сервера и номера порта, используемого сервером.
	
	Разработанное серверное приложение должно предоставлять пользователю настройку корневого каталога для клиентских приложений.

	\item \textbf{Методика тестирования.} Для тестирования приложений запускается файловый сервер и несколько клиентов. В процессе тестирования проверяются основные возможности приложения по передаче файлов и навигации по системе каталогов.

\end{itemize}

\newpage

\section{Прикладной протокол}

Для выполнения технического задания был разработан прикладной протокол, определяющий взаимодействие между клиентом и сервером.

\begin{table}[H]
	\centering
	\def\tabcolsep{10pt}
	\caption{Форматы запросов и ответов}
	\resizebox{\textwidth}{!}{%
		\begin{tabular}{|c|l|l|}
			\hline
			\textbf{Запрос} & \multicolumn{1}{c|}{\textbf{Формат запроса}} & \multicolumn{1}{c|}{\textbf{Формат ответа}} \\ \hline
			Подключение & \code{00} & \code{XX} \\ \cline{2-3} 
			\code{CONNECT} & \code{1} байт & \code{1} \\ \hline
			Отключение & \code{01} & \code{XX} \\ \cline{2-3} 
			\code{DISCONNECT} & \code{1} байт & \code{1} байт \\ \hline
			Текущая директория & \code{02} & \code{00 M [NAME]} / \code{XX} \\ \cline{2-3} 
			\code{PWD} & \code{1} байт & \code{1 + 8 + M} байт / \code{1} байт \\ \hline
			Список файлов & \code{03} & \code{00 M [N_1 NAME]...[N_M NAME]} / \code{XX} \\ \cline{2-3} 
			\code{LS} & \code{1} байт & \code{1 + 8 + N_1 +...+ N_M} байт / \code{1} байт \\ \hline
			Смена директории & \code{04 M [NAME]} & \code{XX} \\ \cline{2-3} 
			\code{CD} & \code{1 + 8 + M} байт & \code{1} байт \\ \hline
			Скачивание файла & \code{05 M [NAME]} & \code{00 M [DATA]} / \code{XX} \\ \cline{2-3} 
			\code{GET} & \code{1 + 8 + M} байт & \code{1 + 8 + M} / \code{1} байт \\ \hline
			Загрузка файла & \code{06 M [NAME] N [DATA]} & \code{XX} \\ \cline{2-3} 
			\code{PUT} & \code{1 + 8 + M + 8 + N} байт & \code{1} байт \\ \hline
		\end{tabular}%
	}
\end{table}

Ответ \code{XX} -- обобщенный код ответа, который если не равен нулю сообщает об ошибке. Возможные ответы:

\begin{itemize}
	\item \code{00} -- \code{OK}: нет ошибок;
	\item \code{01} -- \code{ERROR}: ошибка общего вида;
	\item \code{02} -- \code{NOT_DIRECTORY}: передаваемый путь ведет не к директории;
	\item \code{03} -- \code{NOT_REGULAR_FILE}: передаваемый путь ведет не к простому файлу;
	\item \code{04} -- \code{NOT_EXISTS}: передаваемый путь ведет к несуществующему файлу или директории;
	\item \code{05} -- \code{ALREADY_EXISTS}: передаваемый путь ведет к существующему файлу или директории.
\end{itemize}

\newpage

\section{Описание архитектур}

% Описание архитектур приложений на основе TCP и UDP, их особенностей и ограничений (с графическими схемами).

\subsection{Вспомогательные классы для TCP и UDP}

В библиотечный модуль \code{ftp_utils} была вынесены перечисления \code{Request} и \code{Response}, описывающий прикладной протокол, не зависящий от реализации:
\begin{itemize}
	\item \code{enum Request} -- перечисление, определяющее возможные типы запросов клиента серверу:
	\begin{itemize}
		\item \code{CONNECT} -- оповещение сервера о подключении (возможна реализация авторизации);
		\item \code{DISCONNECT} -- оповещение сервера о закрытии соединения;
		\item \code{PWD} -- запрос текущего пути на сервере;
		\item \code{LS} -- запрос списка файлов в текущей директории;
		\item \code{CD} -- запрос на изменение текущей директории на сервере;
		\item \code{GET} -- запрос на скачивание файла, имя которого указано в запросе;
		\item \code{PUT} -- запрос на загрузку файла, имя которого указано в запросе.
	\end{itemize}
	\item \code{enum Response} -- перечисление, определяющее возможные типы ответов сервера клиенту:
	\begin{itemize}
		\item \code{OK} -- успешно;
		\item \code{ERROR} -- ошибка общего типа;
		\item \code{FILE_DATA} -- указывает на то, что пакет содержит данные файла. Используется как клиентом, так и сервером;
		\item \code{FILE_DATA_END} -- указывает на то, что пакет является последним пакетом, содержащим данные файла. Используется как клиентом, так и сервером;
		\item \code{NOT_DIRECTORY} -- указывает на то, что путь, указанные при запросе \code{CD}, не указывал на директорию на сервере;
		\item \code{NOT_REGULAR_FILE} -- указывает на то, что запрошенный файл не является обычным файлом (например, директорией);
		\item \code{NOT_EXISTS} -- указывает на то, что указанный в запросе файл не существует;
		\item \code{ALREADY_EXISTS} -- указывает на то, что имя, указанное при загрузке файла на сервер, конфликтует с уже существующим файлом.
	\end{itemize}
\end{itemize}

\subsection{Приложение на основе TCP}

Разработанный проект \code{ftp_tcp} для удобства был разбит на модули:
\begin{itemize}
	\item \code{ftp_tcp_utils} -- библиотечный модуль, в который вынесена логика, общая для сервера и клиента;
	\item \code{ftp_tcp_server} -- серверной приложение, обеспечивающее функции обмена файлами;
	\item \code{ftp_tcp_client} -- приложение-клиент, обеспечивающее функции обмена файлами.
\end{itemize}

\subsubsection{Модуль \code{ftp_tcp_utils}}

В библиотечный модуль \code{utils} была вынесена логика, общая для \code{ftp_tcp_server} и \code{ftp_tcp_client}:
\begin{itemize}
	\item \code{class SocketIO} -- класс, предоставляющий серверу и клиенту методы для отправки запросов и ответов и инкапсулирующий в себе работу с сокетом.
	\item \code{readn} -- функция, используемая в \code{SocketIO} для считывания нужного количества байт при чтении из сокета.

\end{itemize}

\subsubsection{Модуль \code{ftp_tcp_server}}

Модуль \code{ftp_tcp_server} представлет собой серверное приложение, обеспечивающее обработку запросов от нескольких клиентов:
\begin{itemize}
	\item \code{class FTPServer} -- класс, предоставляющий обработчик запросов: в вечном цикле происходит принятие и обработка запросов клиента, а также формирование ответов.
	\item \code{server} -- файл, содержащий функцию \code{main} и  основную логику принятия соединений, создания экземпляров \code{FTPServer} и получения команд из консоли.
\end{itemize}

\subsubsection{Модуль \code{ftp_tcp_client}}

Модуль \code{ftp_tcp_client} представляет собой клиентское приложение, позволяющее формировать запросы и получать ответы от серверного приложения:
\begin{itemize}
	\item \code{class FTPEntity} -- класс, упрощающий работу клиентскому приложению с получаемым списком файлов/директорий.
	\item \code{class FTPClient} -- класс, формирующий запросы к серверу и интерпретирующий ответы сервера.
	\item \code{client} -- файл, содержащий функцию \code{main} и основную логику обработки пользовательских команд, введенных в консоль.
\end{itemize}

\subsection{Приложение на основе UDP}

Приложение, построенное на основе UDP \code{ftp_udp} аналогичным образом было разбито на модули:
\begin{itemize}
	\item \code{ftp_udp_utils} -- библиотечный модуль, в который вынесена логика, общая для сервера и клиента;
	\item \code{ftp_udp_server} -- серверной приложение, обеспечивающее функции обмена файлами;
	\item \code{ftp_udp_client} -- приложение-клиент, обеспечивающее функции обмена файлами.
\end{itemize}

\subsubsection{Модуль \code{ftp_udp_utils}}

\begin{itemize}
		\item \code{enum PackageType} -- перечисление, определяющее возможные типы пакетов при общении клиента и сервера:
	\begin{itemize}
		\item \code{REQUEST} -- запрос;
		\item \code{RESPONSE} -- ответ;
		\item \code{ACK} -- подтверждение о получении пакета;
		\item \code{EMPTY} -- пустой пакет, служит для идентификации того, что пакет получить не удалось.
	\end{itemize}
	\item \code{class Package} -- является единицой пересылки между клиентом и сервером. Класс включает в себя:
	\begin{itemize}
		\item счетчик \code{size_t counter}, являющийся уникальным числом для всех пакетов;
		\item тип пакета \code{PackageType packageType};
		\item код запроса (\code{Request}) или ответа (\code{Response}) \code{reqresp};
		\item указатель на массив байт \code{char* data}, представляющие собой передаваемые данные.
	\end{itemize}
	\item \code{class Peer} -- служит для идентификации участника обмена и инкапсулирует внутри себя IP-адрес и порт. 
\end{itemize}

\subsubsection{Модуль \code{ftp_udp_server}}

\subsubsection{Модуль \code{ftp_tcp_server}}

\section{Особенности реализации}

% Особенности реализации сетевых и многопоточных приложений: readn, завершение потоков, мьютексы и др.

\section{Результаты тестирования}

% Результаты тестирования приложения (с разным набором входных данных, методика тестирования параллельности обработки запросов клиентов, проверка программы на потерю, дублирование и перемешивание дейтаграмм).

\section{Выводы}

% Раздел «Выводы» должен включать в себя содержательные выводы, сделанные именно по данной работе. Здесь следует подчеркнуть особенности используемых протоколов, режимов работы, применяемых технологий и библиотек.

\newpage

\section*{Приложение}

% В «Приложениях» приводятся прокомментированные исходные тексты разработанных во время лабораторных работ программ. Программы должны быть распечатаны моноширинным шрифтом (например, Courier, кегль– 9).

\end{document}
